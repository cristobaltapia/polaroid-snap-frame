#!/bin/bash

photo=$1
outname=snap-${photo}

# TODO: get the original size of the image

# Dimensions of the picture (in pixels)
w=1520.0
h=1000.0

# needed crop to pass from 4:3 to 7.6:5
bcrop=`echo "0.1228 * $h" | bc`

# Size of the borders
r_bleft=0.159
r_bright=0.033
r_btop=0.06
r_bbottom=0.06

bleft=`echo "$r_bleft * $w" | bc`
bright=`echo "$r_bright * $w" | bc`
btop=`echo "$r_btop * $h" | bc`
bbottom=`echo "$r_bbottom * $h" | bc`

brsides=`echo "$bright - $bleft" | bc`

# Process the image with imageMagick
convert ${photo} -geometry ${h}x${h} -crop +0-${bcrop} \
        -geometry ${w}x${h} \
        -crop -${bright}+${btop} \
        -crop +${bleft}-${bbottom} \
        aux_1.jpeg

convert -size ${w}x${h} xc:white \
    aux_1.jpeg -geometry +${bleft}+${btop} -composite ${outname}

# Delete temporary files
rm aux_*.jpeg
